@model IEnumerable<OnlineCourse.Entity.Models.Present>
@{
    ViewData["Title"] = "انتخاب درس";
    Layout = "~/Areas/Student/Views/Shared/_Layout.cshtml";
}
<!-- Main content -->
<section class="content">
    <div class="row">
        <div class="col-md-12 col-lg-12 col-sm-12 col-xs-12">
            <form asp-action="SelectCourse" method="Post">
                <div class="box box-default">
                    <div class="box-header with-border">
                        <b>@ViewData["Title"]</b>
                    </div>
                    <div class="box-body">
                        @if (!Model.Any())
                        {
                            <div>
                                <hr />
                                <p class="text-center">
                                    <i class="fa fa-frown-o fa-3x" aria-hidden="true"></i>
                                </p>
                                <h4 class="text-center">هیچ درسی در مقطع شما ارایه نشده است که انتخاب نکرده باشید.</h4>
                                <hr />
                            </div>
                        }
                        else
                        {
                            <table class="table table-bordered table-striped table-hover">
                                <thead>
                                    <tr>
                                        <th>
                                            Id
                                        </th>
                                        <th>
                                            نام درس
                                        </th>
                                        <th>
                                            نام استاد
                                        </th>
                                        <th>
                                            روزهای هفته
                                        </th>
                                        <th>
                                            هزینه دوره
                                        </th>
                                        <th>
                                            مبلغ پرداختی
                                        </th>
                                        <th>
                                            مانده
                                        </th>
                                        <th>
                                            انتخاب
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @{
                                        var indx = 0;
                                    }
                                    @foreach (var item in Model)
                                    {
                                        <tr data-id="@item.Id" data-totalCost="@((item.Section.TotalTime*item.Section.HourlyPrice).ToString("0"))">
                                            <td class="PresentId">
                                                @item.Id
                                            </td>
                                            <td>
                                                @item.Section.Course.CourseName
                                            </td>
                                            <td>
                                                @item.Section.Teacher.FullName
                                            </td>
                                            <td>
                                                @{
                                                    var days = item.Schedules.ToList();
                                                    for (var i = 0; i < days.Count(); i++)
                                                    {
                                                        if (i == days.Count() - 1 || days.Count() == 1)
                                                        {
                                                            <span style="cursor: pointer" data-toggle="tooltip" title="@days[i].StartTime.ToString(@"hh\:mm") تا @days[i].EndTime.ToString(@"hh\:mm")">
                                                                @(EnumExtention.GetDescription(days[i].DayOfWeek))
                                                            </span>
                                                        }
                                                        else
                                                        {
                                                            <span style="cursor: pointer" data-toggle="tooltip" title="@days[i].StartTime.ToString(@"hh\:mm") تا @days[i].EndTime.ToString(@"hh\:mm")">
                                                                @(EnumExtention.GetDescription(days[i].DayOfWeek)) ,
                                                            </span>
                                                        }
                                                    }
                                                }


                                            </td>
                                            <td>
                                                @((item.Section.TotalTime*item.Section.HourlyPrice).ToString("N0")) تومان
                                            </td>
                                            <td>
                                                <input  class="paymentAmount"  type="number" name="paymentAmount[@indx]" />
                                            </td>
                                            <td>
                                                <span class="remain"></span>
                                            </td>
                                            <td>
                                                <input class="selectedCourse" type="checkbox" name="selected[@indx]" />
                                            </td>
                                            @{
                                                indx++;
                                            }
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        }

                    </div>
                    <div class="box-footer">
                        @if (Model.Any())
                        {
                            <button type="submit" class="btn btn-success  box-button">ادامه و پرداخت</button>
                        }
                        <a asp-action="Index" class="btn btn-info  box-title"><i class="fa fa-backward"></i></a>

                    </div>
                </div>
            </form>
        </div>
    </div>
    <!-- /.row -->
</section>
<!-- /.content -->


@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script>

        $(document).ready(function() {
            $(".selectedCourse").click(function() {
                console.log($(this).is(':checked'));
                if ($(this).is(':checked')) {
                    var tr = $(this).closest("tr");
                    //var presentid = $(this).closest("tr").data("id");
                    var totalcost = tr.data("totalCost");
                    var presentid = tr.data("id");
                    var payCost = tr.find(".paymentAmount").val();
                    var remain = totalcost - payCost;
                    tr.find(".remain").innerHTML=remain;

                    console.log(tr.data("totalCost"));
                    console.log(remain);
                    console.log(presentid);
                    console.log(payCost);

                } else {
                    
                }
            });
            courseCart.addItemToCart("1","100000");
        });
    </script>

}